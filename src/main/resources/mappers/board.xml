<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gma.gmagame.mapper.BoardMapper">
    <select id="selectAll" resultType="com.gma.gmagame.model.Board">
        SELECT * FROM board_aa
        WHERE <![CDATA[board_idx<=10]]>
    </select>
    <select id="countBoard" resultType="int">
        SELECT COUNT(*) FROM board_aa
        <include refid="search" />
    </select>
    <!-- 페이징 처리 후 게시글 조회 -->
    <select id="selectBoard" resultType="com.gma.gmagame.model.Board">
        SELECT board_idx,title,contents,hit_cnt,created_datetime,creator_id
        FROM ( SELECT ROWNUM RN, A.*
        FROM ( SELECT * FROM board_aa ORDER BY board_idx asc ) A )
        WHERE RN BETWEEN #{start} AND #{end}
    </select>

    <select id="count" resultType="int">
        select count(*) from board_aa
    </select>
    <select id="selectOne" resultType="com.gma.gmagame.model.Board">
        SELECT *
        FROM board_aa
        WHERE board_idx=#{user_idx}
    </select>


    <update id="updateViewCnt" parameterType="com.gma.gmagame.model.Board">
        UPDATE board_aa
        SET hit_cnt = hit_cnt+1
        WHERE board_idx=#{user_idx}
    </update>

    <insert id="insertOne" parameterType="com.gma.gmagame.model.Board">
        <selectKey resultType="Integer" keyProperty="user_idx" order="BEFORE">
            SELECT NVL(MAX(board_idx),0)+1
            FROM board_aa
        </selectKey>
        INSERT INTO board_aa (board_idx,title,contents,created_datetime,creator_id)
        VALUES(#{user_idx},#{title},#{contents},SYSDATE,#{name})
    </insert>

    <delete id="deleteOne" parameterType="com.gma.gmagame.model.Board">
        DELETE
        FROM board_aa
        WHERE board_idx=#{user_idx}
    </delete>

    <update id="updateOne" parameterType="com.gma.gmagame.model.Board">
        UPDATE board_aa
        SET title =#{title},contents=#{contents}
        WHERE board_idx=#{user_idx}
    </update>
    <select id="selectBoardKeyWord" resultType="com.gma.gmagame.model.Board">
        SELECT board_idx,title,contents,hit_cnt,created_datetime,creator_id
        FROM ( SELECT ROWNUM RN, A.*
        FROM ( SELECT * FROM board_aa ORDER BY board_idx asc ) A )
        WHERE title LIKE '%' ||#{keyword}||'%'
    </select>
    <select id="searchCountBoard" resultType="int">
        SELECT COUNT(*) FROM board_aa
        WHERE title LIKE '%' ||#{keyword}||'%'
    </select>
    <sql id="search">
        <if test="condition == 'title'">
            WHERE title LIKE '%' ||#{keyword}||'%'
        </if>
    </sql>
</mapper>